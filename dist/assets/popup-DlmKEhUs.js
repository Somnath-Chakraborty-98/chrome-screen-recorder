import{r as A,j as c,c as T}from"./client-DxG0HZKh.js";const F="modulepreload",V=function(e){return"/"+e},L={},_=function(t,r,s){let n=Promise.resolve();if(r&&r.length>0){let l=function(i){return Promise.all(i.map(f=>Promise.resolve(f).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),d=o?.nonce||o?.getAttribute("nonce");n=l(r.map(i=>{if(i=V(i),i in L)return;L[i]=!0;const f=i.endsWith(".css"),h=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${h}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":F,f||(u.as="script"),u.crossOrigin="",u.href=i,d&&u.setAttribute("nonce",d),document.head.appendChild(u),f)return new Promise((b,U)=>{u.addEventListener("load",b),u.addEventListener("error",()=>U(new Error(`Unable to preload CSS for ${i}`)))})}))}function a(o){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=o,window.dispatchEvent(d),!d.defaultPrevented)throw o}return n.then(o=>{for(const d of o||[])d.status==="rejected"&&a(d.reason);return t().catch(a)})};var w=A();function W({isRecording:e,onStart:t,onStop:r}){return c.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e?c.jsx("button",{onClick:()=>void r(),children:"Stop Recording"}):c.jsx("button",{onClick:()=>void t(),children:"Start Recording"}),c.jsx("button",{className:"secondary",onClick:()=>alert("Open options (not implemented)"),children:"Options"})]})}function $({recordings:e}){return e.length?c.jsx("div",{children:e.map(t=>c.jsxs("div",{className:"recording-item",children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontSize:13},children:t.name}),c.jsx("div",{className:"meta",children:new Date(Number(t.id.split("-")[1])).toLocaleString()})]}),c.jsxs("div",{style:{display:"flex",gap:6},children:[t.url&&c.jsx("a",{href:t.url,target:"_blank",rel:"noreferrer",children:c.jsx("button",{className:"secondary",children:"Play"})}),c.jsx("button",{className:"secondary",onClick:()=>{navigator.clipboard.writeText(t.url||""),alert("URL copied")},children:"Copy URL"})]})]},t.id))}):c.jsx("div",{style:{color:"#94a3b8"},children:"No recordings yet"})}function K({transcript:e}){return e?c.jsx("div",{style:{fontSize:13,lineHeight:1.35,whiteSpace:"pre-wrap"},children:e}):c.jsx("div",{style:{color:"#94a3b8"},children:"No transcript available"})}async function z(e,t,r=!0){const s=URL.createObjectURL(e);if(typeof chrome<"u"&&chrome.downloads&&typeof chrome.downloads.download=="function")return new Promise((n,a)=>{try{chrome.downloads.download({url:s,filename:t,saveAs:!!r},o=>{if(setTimeout(()=>URL.revokeObjectURL(s),1500),chrome.runtime&&chrome.runtime.lastError){a(new Error(chrome.runtime.lastError.message));return}n(o)})}catch(o){URL.revokeObjectURL(s),a(o)}});if("showSaveFilePicker"in window)try{const a=await(await window.showSaveFilePicker({suggestedName:t,types:[{description:"WebM video",accept:{"video/webm":[".webm"]}}]})).createWritable();await a.write(e),await a.close(),URL.revokeObjectURL(s);return}catch(n){throw URL.revokeObjectURL(s),n}try{const n=document.createElement("a");n.href=s,n.download=t,document.body.appendChild(n),n.click(),n.remove(),setTimeout(()=>URL.revokeObjectURL(s),1500);return}catch(n){throw URL.revokeObjectURL(s),n}}const j=(e,t)=>t.some(r=>e instanceof r);let S,P;function q(){return S||(S=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function H(){return P||(P=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const E=new WeakMap,g=new WeakMap,p=new WeakMap;function G(e){const t=new Promise((r,s)=>{const n=()=>{e.removeEventListener("success",a),e.removeEventListener("error",o)},a=()=>{r(m(e.result)),n()},o=()=>{s(e.error),n()};e.addEventListener("success",a),e.addEventListener("error",o)});return p.set(t,e),t}function J(e){if(E.has(e))return;const t=new Promise((r,s)=>{const n=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",o),e.removeEventListener("abort",o)},a=()=>{r(),n()},o=()=>{s(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",a),e.addEventListener("error",o),e.addEventListener("abort",o)});E.set(e,t)}let R={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return E.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return m(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function N(e){R=e(R)}function Q(e){return H().includes(e)?function(...t){return e.apply(D(this),t),m(this.request)}:function(...t){return m(e.apply(D(this),t))}}function X(e){return typeof e=="function"?Q(e):(e instanceof IDBTransaction&&J(e),j(e,q())?new Proxy(e,R):e)}function m(e){if(e instanceof IDBRequest)return G(e);if(g.has(e))return g.get(e);const t=X(e);return t!==e&&(g.set(e,t),p.set(t,e)),t}const D=e=>p.get(e);function Y(e,t,{blocked:r,upgrade:s,blocking:n,terminated:a}={}){const o=indexedDB.open(e,t),d=m(o);return s&&o.addEventListener("upgradeneeded",l=>{s(m(o.result),l.oldVersion,l.newVersion,m(o.transaction),l)}),r&&o.addEventListener("blocked",l=>r(l.oldVersion,l.newVersion,l)),d.then(l=>{a&&l.addEventListener("close",()=>a()),n&&l.addEventListener("versionchange",i=>n(i.oldVersion,i.newVersion,i))}).catch(()=>{}),d}const Z=["get","getKey","getAll","getAllKeys","count"],ee=["put","add","delete","clear"],v=new Map;function B(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(v.get(t))return v.get(t);const r=t.replace(/FromIndex$/,""),s=t!==r,n=ee.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(n||Z.includes(r)))return;const a=async function(o,...d){const l=this.transaction(o,n?"readwrite":"readonly");let i=l.store;return s&&(i=i.index(d.shift())),(await Promise.all([i[r](...d),n&&l.done]))[0]};return v.set(t,a),a}N(e=>({...e,get:(t,r,s)=>B(t,r)||e.get(t,r,s),has:(t,r)=>!!B(t,r)||e.has(t,r)}));const te=["continue","continuePrimaryKey","advance"],C={},I=new WeakMap,O=new WeakMap,re={get(e,t){if(!te.includes(t))return e[t];let r=C[t];return r||(r=C[t]=function(...s){I.set(this,O.get(this)[t](...s))}),r}};async function*ne(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const r=new Proxy(t,re);for(O.set(r,t),p.set(r,D(t));t;)yield r,t=await(I.get(r)||t.continue()),I.delete(r)}function k(e,t){return t===Symbol.asyncIterator&&j(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&j(e,[IDBIndex,IDBObjectStore])}N(e=>({...e,get(t,r,s){return k(t,r)?ne:e.get(t,r,s)},has(t,r){return k(t,r)||e.has(t,r)}}));const oe="screen-recorder-db",y="recordings",se=1;let x=null;function M(){return x||(x=Y(oe,se,{upgrade(e){e.objectStoreNames.contains(y)||e.createObjectStore(y,{keyPath:"id"}).createIndex("createdAt","createdAt")}})),x}async function ce(e,t,r={}){const s=await M(),n={id:e,name:r.name||`${e}.webm`,blob:t,meta:r,createdAt:Date.now()};return await s.put(y,n),n}async function ie(e){await(await M()).delete(y,e)}function ae(){const[e,t]=w.useState([]),[r,s]=w.useState(!1),[n,a]=w.useState(null),o=w.useRef(null);w.useEffect(()=>{},[]);async function d(){try{const f=await(await _(()=>import("./recorder-CXE9GpRW.js"),[])).startRecorder({onChunk:h=>{},onError:h=>console.error("Recorder error",h)});o.current=f,s(!0)}catch(i){console.error("Failed to start recorder",i),alert("Unable to start recording. Please grant permissions and try again.")}}async function l(){if(o.current)try{const i=await o.current.stop();s(!1),o.current=null;const f=`rec-${Date.now()}`,h=`${f}.webm`;try{await z(i,h,!0)}catch(u){console.error("Download failed:",u),await ce(f,i,{name:h}),alert("Automatic download failed; recording saved locally inside the extension.")}try{await ie(f)}catch(u){console.warn("Failed to delete indexeddb entry:",u)}t(u=>u.filter(b=>b.id!==f))}catch(i){console.error("Failed to stop recorder",i),alert("Failed to finalize recording: "+String(i))}}return c.jsxs("div",{className:"popup-root",children:[c.jsx("header",{className:"header",children:c.jsx("h1",{children:"Screen Recorder"})}),c.jsxs("main",{children:[c.jsx(W,{isRecording:r,onStart:d,onStop:l}),c.jsxs("section",{className:"section",children:[c.jsx("h2",{children:"Recordings"}),c.jsx($,{recordings:e})]}),c.jsxs("section",{className:"section",children:[c.jsx("h2",{children:"Transcript"}),c.jsx(K,{transcript:n})]})]}),c.jsx("footer",{className:"footer",children:"v0.1 â€” Local only"})]})}const de=document.getElementById("root");T.createRoot(de).render(c.jsx(ae,{}));
