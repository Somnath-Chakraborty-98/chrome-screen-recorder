import{r as T,j as r,c as V}from"./client-DxG0HZKh.js";const _="modulepreload",U=function(e){return"/"+e},R={},F=function(t,n,i){let c=Promise.resolve();if(n&&n.length>0){let d=function(s){return Promise.all(s.map(f=>Promise.resolve(f).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");c=d(n.map(s=>{if(s=U(s),s in R)return;R[s]=!0;const f=s.endsWith(".css"),h=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${h}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":_,f||(u.as="script"),u.crossOrigin="",u.href=s,a&&u.setAttribute("nonce",a),document.head.appendChild(u),f)return new Promise((b,O)=>{u.addEventListener("load",b),u.addEventListener("error",()=>O(new Error(`Unable to preload CSS for ${s}`)))})}))}function l(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return c.then(o=>{for(const a of o||[])a.status==="rejected"&&l(a.reason);return t().catch(l)})};var y=T();function W({isRecording:e,onStart:t,onStop:n}){return r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e?r.jsx("button",{onClick:()=>void n(),children:"Stop Recording"}):r.jsx("button",{onClick:()=>void t(),children:"Start Recording"}),r.jsx("button",{className:"secondary",onClick:()=>alert("Open options (not implemented)"),children:"Options"})]})}function $({recordings:e}){return e.length?r.jsx("div",{children:e.map(t=>r.jsxs("div",{className:"recording-item",children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13},children:t.name}),r.jsx("div",{className:"meta",children:new Date(Number(t.id.split("-")[1])).toLocaleString()})]}),r.jsxs("div",{style:{display:"flex",gap:6},children:[t.url&&r.jsx("a",{href:t.url,target:"_blank",rel:"noreferrer",children:r.jsx("button",{className:"secondary",children:"Play"})}),r.jsx("button",{className:"secondary",onClick:()=>{navigator.clipboard.writeText(t.url||""),alert("URL copied")},children:"Copy URL"})]})]},t.id))}):r.jsx("div",{style:{color:"#94a3b8"},children:"No recordings yet"})}function K({transcript:e}){return e?r.jsx("div",{style:{fontSize:13,lineHeight:1.35,whiteSpace:"pre-wrap"},children:e}):r.jsx("div",{style:{color:"#94a3b8"},children:"No transcript available"})}async function z(e,t){const n=URL.createObjectURL(e);return new Promise((i,c)=>{chrome.downloads.download({url:n,filename:t,saveAs:!0},l=>{if(chrome.runtime.lastError){c(new Error(chrome.runtime.lastError.message));return}setTimeout(()=>URL.revokeObjectURL(n),2e3),i()})})}const E=(e,t)=>t.some(n=>e instanceof n);let P,B;function q(){return P||(P=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function H(){return B||(B=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const v=new WeakMap,g=new WeakMap,p=new WeakMap;function G(e){const t=new Promise((n,i)=>{const c=()=>{e.removeEventListener("success",l),e.removeEventListener("error",o)},l=()=>{n(m(e.result)),c()},o=()=>{i(e.error),c()};e.addEventListener("success",l),e.addEventListener("error",o)});return p.set(t,e),t}function J(e){if(v.has(e))return;const t=new Promise((n,i)=>{const c=()=>{e.removeEventListener("complete",l),e.removeEventListener("error",o),e.removeEventListener("abort",o)},l=()=>{n(),c()},o=()=>{i(e.error||new DOMException("AbortError","AbortError")),c()};e.addEventListener("complete",l),e.addEventListener("error",o),e.addEventListener("abort",o)});v.set(e,t)}let I={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return v.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function M(e){I=e(I)}function Q(e){return H().includes(e)?function(...t){return e.apply(D(this),t),m(this.request)}:function(...t){return m(e.apply(D(this),t))}}function X(e){return typeof e=="function"?Q(e):(e instanceof IDBTransaction&&J(e),E(e,q())?new Proxy(e,I):e)}function m(e){if(e instanceof IDBRequest)return G(e);if(g.has(e))return g.get(e);const t=X(e);return t!==e&&(g.set(e,t),p.set(t,e)),t}const D=e=>p.get(e);function Y(e,t,{blocked:n,upgrade:i,blocking:c,terminated:l}={}){const o=indexedDB.open(e,t),a=m(o);return i&&o.addEventListener("upgradeneeded",d=>{i(m(o.result),d.oldVersion,d.newVersion,m(o.transaction),d)}),n&&o.addEventListener("blocked",d=>n(d.oldVersion,d.newVersion,d)),a.then(d=>{l&&d.addEventListener("close",()=>l()),c&&d.addEventListener("versionchange",s=>c(s.oldVersion,s.newVersion,s))}).catch(()=>{}),a}const Z=["get","getKey","getAll","getAllKeys","count"],ee=["put","add","delete","clear"],x=new Map;function L(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(x.get(t))return x.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,c=ee.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(c||Z.includes(n)))return;const l=async function(o,...a){const d=this.transaction(o,c?"readwrite":"readonly");let s=d.store;return i&&(s=s.index(a.shift())),(await Promise.all([s[n](...a),c&&d.done]))[0]};return x.set(t,l),l}M(e=>({...e,get:(t,n,i)=>L(t,n)||e.get(t,n,i),has:(t,n)=>!!L(t,n)||e.has(t,n)}));const te=["continue","continuePrimaryKey","advance"],C={},S=new WeakMap,A=new WeakMap,ne={get(e,t){if(!te.includes(t))return e[t];let n=C[t];return n||(n=C[t]=function(...i){S.set(this,A.get(this)[t](...i))}),n}};async function*re(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,ne);for(A.set(n,t),p.set(n,D(t));t;)yield n,t=await(S.get(n)||t.continue()),S.delete(n)}function N(e,t){return t===Symbol.asyncIterator&&E(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&E(e,[IDBIndex,IDBObjectStore])}M(e=>({...e,get(t,n,i){return N(t,n)?re:e.get(t,n,i)},has(t,n){return N(t,n)||e.has(t,n)}}));const oe="screen-recorder-db",w="recordings",se=1;let j=null;function k(){return j||(j=Y(oe,se,{upgrade(e){e.objectStoreNames.contains(w)||e.createObjectStore(w,{keyPath:"id"}).createIndex("createdAt","createdAt")}})),j}async function ie(e,t,n={}){const i=await k(),c={id:e,name:n.name||`${e}.webm`,blob:t,meta:n,createdAt:Date.now()};return await i.put(w,c),c}async function ce(e){await(await k()).delete(w,e)}function ae(){const[e,t]=y.useState([]),[n,i]=y.useState(!1),[c,l]=y.useState(null),o=y.useRef(null);y.useEffect(()=>{},[]);async function a(){try{const f=await(await F(()=>import("./recorder-CXE9GpRW.js"),[])).startRecorder({onChunk:h=>{},onError:h=>console.error("Recorder error",h)});o.current=f,i(!0)}catch(s){console.error("Failed to start recorder",s),alert("Unable to start recording. Please grant permissions and try again.")}}async function d(){if(o.current)try{const s=await o.current.stop();i(!1),o.current=null;const f=`rec-${Date.now()}`,h=`${f}.webm`;try{await z(s,h,!0)}catch(u){console.error("Download failed:",u),await ie(f,s,{name:h}),alert("Automatic download failed; recording saved locally inside the extension.")}try{await ce(f)}catch(u){console.warn("Failed to delete indexeddb entry:",u)}t(u=>u.filter(b=>b.id!==f))}catch(s){console.error("Failed to stop recorder",s),alert("Failed to finalize recording: "+String(s))}}return r.jsxs("div",{className:"popup-root",children:[r.jsx("header",{className:"header",children:r.jsx("h1",{children:"Screen Recorder"})}),r.jsxs("main",{children:[r.jsx(W,{isRecording:n,onStart:a,onStop:d}),r.jsxs("section",{className:"section",children:[r.jsx("h2",{children:"Recordings"}),r.jsx($,{recordings:e})]}),r.jsxs("section",{className:"section",children:[r.jsx("h2",{children:"Transcript"}),r.jsx(K,{transcript:c})]})]}),r.jsx("footer",{className:"footer",children:"v0.1 â€” Local only"})]})}const de=document.getElementById("root");V.createRoot(de).render(r.jsx(ae,{}));
